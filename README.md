После того как детальный слой «DS» успешно наполнен исходными данными из файлов –
нужно рассчитать витрину данных финансовой отчетности в слое «DM», которая будет хранить
таблицу оборотов и таблицу 101-й отчётной формы.
Note: Витрина данных (ВД) – это таблица или набор таблиц, который хранит данные
специализированной бизнес-области для использования конкретным бизнес-пользователем
(департаментом/командой/подразделением). Например, Департамент обработки отчетности в
банке может использовать ВД, в которой хранятся данные о финансовой отчетности,
предоставляемой кредитными организациями на регулярной основе. Другой пример:
Департамент риск-менеджмента банка может использовать ВД, где собраны только данные о
просроченных задолженностях по кредитам клиентов банка. С витриной данных сотрудники
могут быстрее получать доступ к данным и статистическим показателям, потому что не нужно
тратить время на поиск по более сложному хранилищу данных или вручную собирать данные
из разных источников.
Для выполнения задачи вам необходимо разработать таблицу оборотов
«DM.DM_ACCOUNT_TURNOVER_F» и таблицу 101-й отчётной формы «DM.DM_F101_ROUND_F»,
и прежде всего нужно создать структуру таблицы и определить типы загружаемых данных. На
вход вам пришли следующие бизнес-требования:
1. Таблица оборотов (DM.DM_ACCOUNT_TURNOVER_F) должна содержать следующие поля:
a. Дата, на которую считаются обороты по счетам
b. Номер счёта
c. Оборот по дебету (в рублях и в тыс.рублей)
d. Оборот по кредиту (в рублях и в тыс.рублей)
2. Таблица 101-й отчётной формы (DM.DM_F101_ROUND_F) должна быть разработана в
соответствие с требованиями по формату данных, предоставленными Центробанком
(https://cbr.ru/banking_sector/otchetnost-kreditnykh-organizaciy/). Иными словами, атрибутный
состав таблицы должен опираться на требования по полям, необходимым для ЦБ, т.к. дальше
отчетность будет направляться именно в этот регуляторный орган. Для выполнения задачи
необходимо опираться на формат до 01.06.2023г.
3. Зачастую в банках мы работаем с уже существующим хранилищем данных, и доработка этого
КХД (на базе которого разрабатывается наша витрина) должна сопровождаться соблюдением
определенных архитектурных стандартов по работе с моделью данных.
Note: Модель данных - это абстрактное, логическое и физическое представление
взаимосвязей объектов хранилища данных (базы данных), операторов и прочих элементов.
Она определяет, каким образом данные могут храниться, организовываться и обрабатываться,
что упрощает работу пользователей с данными, хранящимися в БД/КХД.
4. В рамках данной задачи, вам выставляются следующие архитектурные стандарты в части
правил наименования в модели:
a. Длина кодов сущностей (таблиц) и атрибутов (полей) не должна превышать 63 символа
b. Для создания кодов сущностей (таблиц) и атрибутов (полей) используется underscore нотация
(части наименования разделены символом "_")
c. Модель данных поддерживает следующие типы данных: date, char, varchar, number
d. Для наименования атрибутов необходимо использовать следующий словарь наименований и
сокращений:
Термин Перевод Код
Дебет debet deb
Кредит credit cre
Термин Перевод Код
Счёт account acct
Номер number num
Рубли ruble rub
Количество amount amt
Баланс balance bal
Оборот/Оборотный turnover turn
Валюта currency curr
Значение value val
Входящий in in
Исходящий out out
Всего/Общий/Совокупный total total
Глава chapter chpt
Идентификатор id id
Например, если бы мы называли атрибут "Всего по балансу (в рублях)", используя словарь,
название атрибута в модели данных могло бы выглядеть так: bal_total_rub
Note: При необходимости использовать термины, не входящие в словарь, вы также можете
использовать их перевод, используя аналогичный подход.
Результатом будут являться две таблицы с полностью описанной структурой (перечень
атрибутов и соответствующие типы данных).
После создания таблиц вам необходимо начать заполнять эти таблицы. В рамках задачи для
таблицы DM.DM_ACCOUNT_TURNOVER_F вам необходимо написать прототип,
рассчитывающий кредитовые и дебетовые обороты по счетам за каждый день января 2018
года.
Note: Прототип - это SQL-запрос, в результате которого собирается таблица
 Затем вам необходимо написать прототип для расчёта полей таблицы
«dm.dm_f101_round_f» по следующей логике:
 «Входящие остатки (в рублях/валют/итого)" - рассчитать как баланс по счетам на отчетную
дату (см. таблицу DS.FT_BALANCE_F)
 «Обороты за отчетный период по дебету/кредиту (в рублях/валют/итого)» - рассчитать
как сумму всех проводок за отчетную дату по дебету/кредиту соответственно
 «Исходящие остатки (в рублях)»
для счетов с признаком "Актив" и currency_code '643' рассчитать как Входящие остатки (в
руб.) - Обороты по кредиту (в руб.) + Обороты по дебету (в руб.);
для счетов с признаком "Актив" и currency_code '810' рассчитать как Входящие остатки (в
руб.) - Обороты по кредиту (в руб.) + Обороты по дебету (в руб.);
для счетов с признаком "Пассив" и currency_code '643' рассчитать как Входящие остатки (в
руб.) + Обороты по кредиту (в руб.) - Обороты по дебету (в руб.);
для счетов с признаком "Пассив" и currency_code '810' рассчитать как Входящие остатки (в
руб.) + Обороты по кредиту (в руб.) - Обороты по дебету (в руб.)
 «Исходящие остатки (в валюте)»
для счетов с признаком "Актив" и currency_code не '643' и не '810' рассчитать как Входящие
остатки (в валюте) - Обороты по кредиту (в валюте) + Обороты по дебету
(в валюте);
для счетов с признаком "Пассив" и currency_code не '643' и не '810' рассчитать Входящие
остатки (в валюте) + Обороты по кредиту (в валюте) - Обороты по дебету
(в валюте;
 «Исходящие остатки (итого)»
рассчитать как Исходящие остатки (в валюте) + Исходящие остатки (в рублях)